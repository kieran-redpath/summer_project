---
title: "CCLE_GDSC_27_11_19"
author: "Kieran Redpath"
date: "27 November 2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load Packages}
setwd("~/Documents/R Data/summer_project")
# Packages
library(limma)
library(edgeR)
library(data.table)
library(magrittr)
library(ggplot2)
library(CePa)
library(dplyr)
library(tidyverse)
library(ggbeeswarm)
```

```{r Load Documents}
CCLE_dasat_BCCCGC <- read.csv(CCLE_dasat_BCCCGC)
expDat_sort <- read.csv(expDat_sort)
```

#27_11_19
```{r Add CDH1 Expression Data, and plot it on the boxplot- Real Version, echo=FALSE, include=FALSE}
# Attempt to create a data frame that just has data for CDH1 (Ensembl: ENSG00000039068.14), but across every cell line
CDH1_Exp_Levels <- subset(expDat_sort, rownames(expDat_sort)=="ENSG00000039068.14")
#Reorient "CDH1_Exp_Levels" so it has the same orientation as "CCLE_dasat_BCCCGC"
CDH1_Exp_Levels <- t(CDH1_Exp_Levels)
View(CDH1_Exp_Levels)
# Move row names into the first column, and name it "CCLE_Name"
CDH1_Exp_Levels <- as.data.frame(CDH1_Exp_Levels)
setDT(CDH1_Exp_Levels, keep.rownames = "CCLE_Name")[]
# Filter so lowest 20% is "Low", top 80% is "High" (can replace values later on)
CDH1_Exp_Levels$CDH1_Expression <- ifelse(CDH1_Exp_Levels$ENSG00000039068.14 < quantile(CDH1_Exp_Levels$ENSG00000039068.14, 0.4), "Low","High")

####*Up to Here*#### 
# Create a subset of "CDH1_Exp_Levels", icnluding only those that match "CCLE_dasat_CCBCGC" Note that "CCLE_dasat_BCCCGC" has 202 entries, but we only have CDH1 expression data from 142 of these (those in "Boxplot_data_2")
Boxplot_data_2 <-  setDT(CDH1_Exp_Levels)[CCLE_Name %chin% CCLE_dasat_BCCCGC$CCLE_Name]
View(Boxplot_data_2)

Boxplot_data_2 <- match( CCLE_dasat_BCCCGC$CCLE_Name, CDH1_Exp_Levels$CCLE_Name)
CCLE_dasat_BCCCGC$CDH1_Expression[Boxplot_data_2] <- 
####################

# AUC ggplot (with CDH1 expression levels)
ggplot(data=CCLE_dasat_BCCCGC, mapping=aes(x=CDH1_Expression, y=AUC, fill=CDH1_Expression)) +
  labs(x= "Level of CDH1 Expression", y="IC50", caption="(Data from GDSC and CCLE)") +
  ggtitle("Dasatinib Data", subtitle="IC50 vs Numer of CDH1 Mutations") +
  geom_boxplot() +
  geom_beeswarm()
# IC50 ggplot (with CDH1 expression levels)
ggplot(data=CCLE_dasat_BCCCGC, mapping =aes(x=CDH1_Expression, y=IC50, fill=CDH1_Expression)) +
  labs(x= "Level of CDH1 Expression",y="IC50", caption="(Data from GDSC and CCLE)") +
  ggtitle("Dasatinib Data", subtitle="IC50 vs Number of CDH1 Mutations") +
  geom_boxplot() +
  geom_beeswarm()
```


Save some data.frames as files using write.csv, so you can just load them back in and not worry about being in the same markdown.


Work back through everything and double check that it's all sorted in the right way- I.e. at no point have  sorted things been joined in the wrong order (which would give you a table with absolutely no correlation).

Use a control- note the expression data for a particular cell line and CDH1, so you can double check that they remain associated.

Learn how to use the join command!!! Look at the book and Michaela's notes.

Then Get Back to Your Last Chunk:

Add in CDH1 expression to your dataframe.
look at low expression (bottom 20% of expression) vs AUC and IC50 (boxplot and overlaid beeswarm if you have a lot of data).
match CCLE_Name to expression data (so you get CDH1 expression levels for the right cell lines) to pull out those that match your data frame and add them to "CCLE_dasat_BCCCGC"

Also do expression vs mutation status (I.e does expression level correlate with mutation)